<mat-sidenav-container class="sidenav-container">

  <!-- ================= LEFT SIDENAV ================= -->
  <mat-sidenav mode="side" opened>

    <h3 class="side-title">Admin Panel</h3>

<button mat-button routerLink="/admin/dashboard" routerLinkActive="active">
  Dashboard
</button>

<button mat-button routerLink="/admin/dashboard" routerLinkActive="active">
  Requests
</button>


<button mat-button color="warn" (click)="logout()">
  Logout
</button>


  </mat-sidenav>

  <!-- ================= MAIN CONTENT ================= -->
  <mat-sidenav-content>

    <!-- TOP TOOLBAR -->
    <mat-toolbar color="primary">
      <span>üõ†Ô∏è Digital Maintenance Tracker ‚Äî Admin</span>
    </mat-toolbar>

    <!-- DASHBOARD BODY -->
    <div class="dashboard-container">

      <!-- ======= SUMMARY CARDS ======= -->
      <div class="stats-container">

  <mat-card class="stat-card">
    <h3>Total Requests</h3>
    <p>{{ totalRequests }}</p>
  </mat-card>

  <mat-card class="stat-card">
    <h3>New</h3>
    <p>{{ newRequests }}</p>
  </mat-card>

  <mat-card class="stat-card">
    <h3>Assigned</h3>
    <p>{{ assignedRequests }}</p>
  </mat-card>

</div>


      <!-- ======= REQUEST TABLE ======= -->
      <mat-card>
        <mat-card-title>Maintenance Requests</mat-card-title>

        <table mat-table [dataSource]="requests" class="full-width mat-elevation-z8">

          <!-- ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let r">{{ r.id }}</td>
          </ng-container>

          <!-- Category -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Category</th>
            <td mat-cell *matCellDef="let r">{{ r.category }}</td>
          </ng-container>

          <!-- Description -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>Description</th>
            <td mat-cell *matCellDef="let r">{{ r.description }}</td>
          </ng-container>

          <!-- Technician -->
          <ng-container matColumnDef="technician">
            <th mat-header-cell *matHeaderCellDef>Technician</th>
            <td mat-cell *matCellDef="let r">

              <mat-select
                *ngIf="r.status === 'New'"
                [(value)]="selectedTech[r.id]"
                placeholder="Select technician"
              >
                <mat-option *ngFor="let t of technicians" [value]="t.id">
                  {{ t.name }}
                </mat-option>
              </mat-select>

              <span *ngIf="r.status !== 'New'">
                {{ r.technician_name || 'Assigned' }}
              </span>

            </td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let r">
              <mat-chip
                [ngClass]="{
                  'new-chip': r.status === 'New',
                  'assigned-chip': r.status === 'Assigned',
                  'resolved-chip': r.status === 'Resolved'
                }"
              >
                {{ r.status }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Action -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Action</th>
            <td mat-cell *matCellDef="let r">
<button
  mat-raised-button
  color="accent"
  *ngIf="r.status === 'New'"
  [disabled]="!selectedTech[r.id]"
  (click)="assign(r.id)">
  Assign
</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        </table>
      </mat-card>

    </div>

  </mat-sidenav-content>
</mat-sidenav-container>
